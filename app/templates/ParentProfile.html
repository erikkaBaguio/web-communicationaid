<!DOCTYPE html>
<html>
<title>Parent</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/w33.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/static/css/w3.css">
<link rel="stylesheet" href="/static/css/font.css">
<link rel="stylesheet" href="/static/css/font-awesome.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-grid.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-reboot.css">
<script type="text/javascript" src="/static/bootstrap/js/bootstrap.js"></script>
<script type="text/javascript" src="/static/bootstrap/js/bootstrap.bundle.js"></script>
<link rel="stylesheet" href="/static/css/agency.min.css">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue-grey.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="/static/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/static/assets/css/light-bootstrap-dashboard.css?v=2.0.1" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="/static/assets/css/demo.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", "sans-serif"}

.submit {
  border: none;
}

.pl {
  overflow-y: scroll !important;
  width: 800px;
  position: relative;
  height: 500px;
}

h5 {
        margin-left: 20px;
    }

    .card h6 {
        margin-left: 20px;
    }
</style>
<class="w3-light-grey">
<body>
<div class="w3-top">
 <div class="w3-bar w3-right-align w3-large w3-teal w3-padding-8">
  <img class="w3-left" src="/static/images/PATicon1.png" style="margin-left: 5%; height: 100%; width: 13%;cursor: pointer;" alt="logo" onclick="dasher()" />
  <script>
        function dasher(){
        var acc_id = localStorage.getItem('acc_id');
        location.href = "/dashboard/parent/"+acc_id;
                      }
  </script>

  <a onclick="logout()" class="w3-bar-item w3-button w3-right w3-padding-large w3-teal"></i>Log Out</a><span class="glyphicon glyphicon-log-out"></span></a>
  <!-- <div class="container">
  <div class="w3-dropdown-hover w3-right w3-hover-teal">  
  <button class="w3-button w3-padding-large w3-teal">Profile</button>
  <div class="w3-dropdown-content w3-bar-block w3-border" style="right:1"><span class="glyphicon glyphicon-home"></span></a>
    <a href="ParentProfile.html" class="w3-bar-item w3-button">Parent Profile</a>
    <a href="ChildProfile.html" class="w3-bar-item w3-button">Child Profile</a>
  </div>
  </div>
</div> -->
</div>


<!-- Page Container -->
<div class="w3-content w3-margin-top" style="max-width:1400px;">

  <!-- The Grid -->
  <div class="w3-row-padding">
  
    <!-- Left Column -->
    <div class="w3-third">
    
    <script>
      function back(){
        location = "p_mode.html"
      }
    </script>

  </a>
      <div class="w3-white w3-text-grey w3-card-16 pull" id="view_teacher">
        <div class="w3-container w3-center" style="margin-left:-30;">
          <div class="w3-container pull-left" style="margin-left:5%; text-align:left;">
            <br>
            <h2 class="w3-disply-bottomleft w3-container w3-text-black"><img src="{{img}}" style="width: 160px; height: 200px; border: 5px solid white; box-shadow: 2px 2px 2px 2px gray;" alt="Avatar"></h2>
            <input onclick="upload()" type="button" class="submit w3-teal w3-round" name="image" value="Edit Picture" style="margin-left: 9%; width: 100px;height: 30px; font-size: 15px; color: white; cursor: pointer;" src="#" />
             <h2 class="w3-disply-bottomleft w3-container w3-text-black" id="name">{{name}}</h2>
             
            <h3 style="font-family: comic sans">{{bio}}</h3>
            <i class="fa fa-home fa-fw w3-margin-right w3-large w3-text-teal"></i><b id="address">{{address}}</b>
            <p style="margin-top: 20px;"><i class="fa fa-envelope fa-fw w3-margin-right w3-large w3-text-teal"></i><b id = "email">{{email}}</b></p>
          
          <p><i class="fa fa-birthday-cake fa-fw w3-margin-right w3-large w3-text-teal"></i><b id="birthday">{{bday}}</b></p>
          <p><i class="fa fa-venus-mars fa-fw w3-margin-right w3-large w3-text-teal"></i><b id="gender_p">{{gender}}</b></p>
          <!-- <p><i class="fa fa-star fa-fw w3-margin-right w3-large w3-text-blue"></i>di ko musaba</p> -->
          <hr>
          <a onclick="edit_info()" class="w3-bar-item w3-button w3-center w3-padding-10 w3-teal   w3-round">Edit Profile</a>
           </div> 
           <br><br>
      </div>
    

      <br>

    <!-- End Left Column -->
    </div><br>

    <!-- End Left Column -->
    </div>

    <!-- Right Column -->
    <div class="w3-twothird">
    
      <div class="w3-row-padding">
        <div class="w3-col m14">
          <div class="w3-card w3-round w3-white">
            <div class="w3-container w3-padding">
              <h6 class="w3-opacity"></h6>
              <center>
              <input id="details" placeholder="What's happening?" class="w3-border w3-padding" style="border-radius: 10px; width: 650px;">
              <button onclick="post()" type="button" class="w3-button w3-teal w3-theme w3-round"><i class="fa fa-pencil"></i>Post</button></center> 
            </div>
          </div>
        </div>

      </div>

      
      <br>

      <!-- <div class="w3-container w3-padding w3-card w3-white w3-round">
        <h2 class="w3-text-grey w3-padding-16"><i class="fa fa-certificate fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Education</h2>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>W3Schools.com</b></h5>
          <h6 class="w3-text-teal"><i class="fa fa-calendar fa-fw w3-margin-right"></i>Forever</h6>
          <p>Web Development! All I need to know in one place</p>
          <hr>
        </div>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>London Business School</b></h5>
          <h6 class="w3-text-teal"><i class="fa fa-calendar fa-fw w3-margin-right"></i>2013 - 2015</h6>
          <p>Master Degree</p>
          <hr>
        </div>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>School of Coding</b></h5>
          <h6 class="w3-text-teal"><i class="fa fa-calendar fa-fw w3-margin-right"></i>2010 - 2013</h6>
          <p>Bachelor Degree</p><br>
        </div>
      </div> -->
      <div id = "forum-parent" class="container pl">
        
      </div>



    <!-- End Right Column -->
    </div>
    
  <!-- End Grid -->
  </div>
  
  <!-- End Page Container -->
</div>  




 <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

 <script>

  function delete_forum(fornum){
    var acc_id = localStorage.getItem("acc_id");

    xhr = new XMLHttpRequest();
    var url  = "https://cryptic-fjord-60133.herokuapp.com/api/delete_forum/"+fornum+"/"+acc_id;
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            location.href = "/parent/profile/"+acc_id;
        }
        // else{
        //     alert("you can only delete your own post")
        // }
    }
    xhr.send();
}


  function delete_comment(comid,forum_no){
    var acc_id = localStorage.getItem("acc_id");

    xhr = new XMLHttpRequest();
    var url  = "https://cryptic-fjord-60133.herokuapp.com/api/delete_comment/"+comid+"/"+acc_id;
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            alert("udong nga lami")
            location.href = "/parent/profile/"+acc_id; 
        }
        // else{
        //     alert("this comment does not belong to you")
        // }
    }
    xhr.send();
}
        
        
   $(document).ready(function(){
    var acc_id = localStorage.getItem('acc_id');
      $.ajax({
        url:"http://cryptic-fjord-60133.herokuapp.com/api/prof_forum="+acc_id,
        
        type:"GET",
        success:function(response){
          data = response.reverse();
        var forum='';
        $.each(data,function(key,value){
          $(document).ready(function(){
            $.getJSON("https://cryptic-fjord-60133.herokuapp.com/api/comment/"+value.forum_no,function(data){
              var forum='';
              $.each(data,function(key,value){
                forum+='<div class="col-md-10"><div class="card"><div class="card-header"><div class="row"><div class="col-md-1"><img src="'+value.image+'" style="height: 50px; width: 50px; border-radius:30%;"></div><div class="col-md-11"><h5 style="font-weight: 600; text-transform: uppercase; ">'+value.name+'</h5><h6 style="text-transform: none; font-weight: 5;">'+value.date+' Time:'+value.time+'</h6><button onclick="delete_comment('+value.comment_id+','+value.forum_no+')" class="w3-large w3-teal pull-right" style="border: none; padding: 3px 13px; margin-top: -60px; padding-bottom: 7px; border-radius: 5px; cursor: pointer;"><i class="fa fa-trash" style="padding-left: -4px; padding-top: 4px;"></i></button></div></div></div><div class="card-body"><div class="row" style="margin-top: 5px; margin-left: 50px;"><div class="col-md-11"><p>'+value.details+'</p></div><div class="col"></div></div></div></div></div>';



              });
              $('#'+value.forum_no).append(forum);
            });
          });

          forum+='<div class="card" style=" box-shadow: 0 0 1px 2px #888;"><div class="card-header"><div class="row"><div class="col-md-1"><img src="'+value.img+'" style="height: 50px; width: 50px; border-radius:30%;"></div><div class="col-md-11"><h5 style="font-weight: 600; text-transform: uppercase; ">'+value.name+'</h5><h6 style="text-transform: none; font-weight: 5;">Date:'+value.date+' Time:'+value.time+'</h6><button onclick="delete_forum('+value.forum_no+')" class="w3-large w3-teal pull-right" style="border: none; padding: 3px 13px; margin-top: -60px; padding-bottom: 7px; border-radius: 5px; cursor: pointer;"><i class="fa fa-trash" style="padding-left: -4px; padding-top: 4px;"></i></button><br><div class="row" style="margin-top: 5px;"><div class="col-md-11"><p>'+value.details+'</p></div><div class="col"></div></div><!-- question here --></div></div></div><div id="'+value.forum_no+'" class="card-body"><hr></div><hr><div class="row"><div class="col-md-12"><div class="form-group"><div class="row"><div class="col-md-9"><input id="'+value.forum_no+'1" type="text" class="form-control" placeholder="Comment" style="margin-left: 80px;"></div><div class="col-md-2"<button onclick="comment('+value.forum_no+')" type="submit" class="btn btn-info btn-fill pull-right" style="border: none; background-color: #009688!important; text-align: center; font-size: 18px; padding-top: 5px; color: white; border-radius: 10px; cursor: pointer;">Comment</button><div class="clearfix"></div></div></div></div></div></div></div></div>';
        });
        $('#forum-parent').append(forum);
        }
      });
    });
  
    function comment(forum_no){
    var acc_id = localStorage.getItem("acc_id");
    
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
    var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
    
    xhr = new XMLHttpRequest();
    var url  = "https://cryptic-fjord-60133.herokuapp.com/api/webcomment";
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            var json = JSON.parse(xhr.responseText);
            alert(json);
            var comment = '';
            comment +='<div class="col-md-10"><div class="card"><div class="card-header"><div class="row"><div class="col-md-1"><img src="{{img}}" style="height: 50px; width: 50px; border-radius:30%;"></div><div class="col-md-11"><h5 style="font-weight: 600; text-transform: uppercase; ">{{name}}</h5><h6 style="text-transform: none; font-weight: 5;">'+json.date+' Time:'+json.time+'</h6><button onclick="delete_forum('+json.comment_id+')" class="w3-large w3-teal pull-right" style="border: none; padding: 3px 13px; margin-top: -60px; padding-bottom: 7px; border-radius: 5px; cursor: pointer;"><i class="fa fa-trash" style="padding-left: -4px; padding-top: 4px;"></i></button></div></div></div><div class="card-body"><div class="row" style="margin-top: 5px; margin-left: 50px;"><div class="col-md-11"><p>'+json.details+'</p></div><div class="col"></div></div></div></div></div>';



            document.getElementById(forum_no+"1").value = "";
            $('#'+forum_no).append(comment);
            // document.getElementById('comment').innerHTML = json.details;
        }
    }
    var json =JSON.stringify({"acc_id": acc_id, 'date':date, 'time':time, "forum_no":forum_no, "details":document.getElementById(forum_no+"1").value});
    console.log(json)
    xhr.send(json);
}

function logout(){
      localStorage.clear();
      window.location.href='/login';
    } 

function post(){
    var acc_id = localStorage.getItem("acc_id");
    
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
    var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
    
    xhr = new XMLHttpRequest();
    var url  = "https://cryptic-fjord-60133.herokuapp.com/api/post_forum";
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            var json = JSON.parse(xhr.responseText);
            location.href = "/parent/profile/"+acc_id;
        }
    }
    var json =JSON.stringify({"acc_id": acc_id, 'date':date, 'time':time, "details":document.getElementById('details').value});
    console.log(json)
    xhr.send(json);
}

  function upload(){
      localStorage.setItem('pedit','true');
      var acc_id = localStorage.getItem('acc_id');
      location = "/pprofilepic/"+acc_id;
    }

    function edit_info(){
      localStorage.setItem('edit', 'true');
      var acc_id = localStorage.getItem('acc_id');
      location.href = "/personalinfo/parent/"+acc_id;
    }

 </script>

</body>

<!--   Core JS Files   -->
<script src="/static/assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="/static/assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="/static/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="/static/assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!--  Chartist Plugin  -->
<script src="/static/assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="/static/assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="/static/assets/js/light-bootstrap-dashboard.js?v=2.0.1" type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="/static/assets/js/demo.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // Javascript method's body can be found in assets/js/demos.js
        demo.initDashboardPageCharts();

    });
</script>
</html>
